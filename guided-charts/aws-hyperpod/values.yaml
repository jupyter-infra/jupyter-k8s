# [AWS HYPERPOD]: Configuration for aws-hyperpod deployment mode
# This includes presigned URL and remote access setup

# [JUPYTER-K8S]: Core jupyter-k8s chart configuration
jupyter-k8s:
  shouldInstall: true
  application:
    imagesPullPolicy: IfNotPresent
    imagesRegistry: 632138803636.dkr.ecr.us-west-2.amazonaws.com
  controllerManager:
    replicas: 1
    container:
      args:
        - "--default-template-namespace=jupyter-k8s-shared"
      env:
        CLUSTER_ADMIN_GROUP: "cluster-workspace-admin"
        CLUSTER_ID: ""
        DOMAIN: ""
        KMS_KEY_ID: ""
      image:
        repository: 632138803636.dkr.ecr.us-west-2.amazonaws.com/jupyter-k8s-operator
        tag: latest
      imagePullPolicy: Always
  rbac:
    enable: true
  crd:
    enable: true
    keep: true
  metrics:
    enable: true
  webhook:
    enable: true
  prometheus:
    enable: false
  certmanager:
    enable: true
  networkPolicy:
    enable: false
  workspacePodWatching:
    enable: true
  accessResources:
    traefik:
      enable: false
    additionalGvk: []
  extensionApi:
    enable: true

namespace: jupyter-k8s-system

# [CLUSTER WEB UI]: Web interface configuration
clusterWebUI:
  enabled: false
  
  # Full domain for the application (required)
  domain: ""

  # AWS Certificate Manager ARN for SSL/TLS termination at load balancer
  awsCertificateArn: ""

  # External DNS configuration
  externalDns:
    enabled: true

  # Network policy configuration
  networkPolicy:
    enabled: true

  # [TRAEFIK]: Reverse proxy configuration
  traefik:
    shouldInstall: false
    repository: public.ecr.aws/docker/library
    imageName: traefik
    imageTag: latest
    replicas: 2
    redirectHttp: true
    debug: false
    allowCrossNamespace: true

  # Authentication middleware configuration
  auth:
    replicas: 1
    imagePullPolicy: Always
    repository: docker.io
    imageName: jupyter-k8s-auth
    imageTag: latest
    resources:
      limits:
        cpu: 200m
        memory: 128Mi
      requests:
        cpu: 200m
        memory: 128Mi
    jwtSigningType: "kms"
    kmsKeyId: ""
    jwtIssuer: "jupyter-k8s-auth"
    jwtAudience: "workspace-users"
    jwtExpiration: "12h"
    jwtRefreshWindow: "15m"
    jwtRefreshHorizon: "12h"
    cookieName: "workspace_auth"
    cookieSecure: "true"
    cookiePath: "/"
    cookieMaxAge: "24h"
    cookieHttpOnly: "true"
    cookieSameSite: "lax"
    pathRegexPattern: "^(/).*$"
    routingMode: "subdomain"
    workspaceNameSubdomainRegex: "^([^-]+)-.*$"
    workspaceNamespaceSubdomainRegex: "^[^-]+-(.*)$"
    maxCookiePaths: "20"
    csrfAuthKey: ""
    csrfCookieName: "workspace_csrf"
    csrfCookieMaxAge: "1h"
    csrfCookieSecure: "true"
    readTimeout: "10s"
    writeTimeout: "10s"
    shutdownTimeout: "30s"
    oauthEnabled: false
    enableBearerAuth: true
    enableRefresh: false

# Remote access configuration
remoteAccess:
  enabled: false
  ssmManagedNodeRole: ""
  ssmSidecarImage:
    containerRegistry: "908061117754.dkr.ecr.us-west-2.amazonaws.com"
    repository: "sagemaker/space-sidecar"
    tag: "0.0.6"
  ssmDocumentName: "SageMaker-SpaceSSHSessionDocument"

# [STORAGE] StorageClasses for Workspaces
storageClass:
  ebs:
    create: true
    name: sagemaker-spaces-default-storage-class
    isDefault: false
    provisioner: ebs.csi.aws.com
    reclaimPolicy: Delete
    volumeBindingMode: WaitForFirstConsumer
    parameters:
      type: gp3
      fsType: ext4
      encrypted: "true"
