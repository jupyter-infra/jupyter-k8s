# [AWS HYPERPOD]: Configuration for aws-hyperpod deployment mode
# This includes presigned URL and remote access setup

namespace: jupyter-k8s-system # TODO consider if we need seperate namespace

# Full domain for the application (required)
domain: ""

# [CONTROLLER] Operator pod scheduling configuration
controller:
  # Node selector for operator pod placement
  nodeSelector: {}
  
  # Tolerations for scheduling on tainted nodes
  tolerations: []
  
  # Affinity rules for operator pod placement
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
            - key: kubernetes.io/arch
              operator: In
              values:
                - amd64
                - arm64
            - key: kubernetes.io/os
              operator: In
              values:
                - linux

# AWS Certificate Manager ARN for SSL/TLS termination at load balancer
# If provided, enables SSL termination at the NLB level
awsCertificateArn: ""

# External DNS configuration
externalDns:
  # Whether to enable external-dns annotations for automatic DNS record creation
  enabled: true

# Remote access configuration
remoteAccess:
  enabled: false
  ssmManagedNodeRole: ""  # REQUIRED: IAM role for SSM managed instances - must be provided during installation
  ssmSidecarImage: ""  # REQURIED: SSM sidecar container image
  ssmDocumentName: "SageMaker-SpaceSSHSessionDocument"  # Custom SSM document name for SSH sessions

# [TRAEFIK]: Configuration for Traefik (optional dependency)
traefik:
  # Whether to deploy Traefik as part of this chart
  enabled: false
  # Traefik configuration (only used when enabled: true)
  # For full configuration options, see: https://github.com/traefik/traefik-helm-chart/blob/master/traefik/values.yaml
  repository: public.ecr.aws/docker/library
  imageName: traefik
  imageTag: latest
  replicas: 2
  redirectHttp: true
  debug: false
  allowCrossNamespace: true

# [STORAGE] StorageClasses for Workspaces
storageClass:
  ebs:
    create: true
    name: sagemaker-spaces-default-storage-class
    isDefault: false
    provisioner: ebs.csi.aws.com
    reclaimPolicy: Delete
    volumeBindingMode: WaitForFirstConsumer
    parameters:
      type: gp3
      fsType: ext4
      encrypted: "true"

# Authmiddleware configuration
authmiddleware:
  # Whether to deploy the authmiddleware component
  enabled: true
  # Number of replicas
  replicas: 1
  # Authmiddleware image settings
  imagePullPolicy: Always
  repository: docker.io
  imageName: jupyter-k8s-auth
  imageTag: latest
  # Resource limits and requests
  resources:
    limits:
      cpu: 200m
      memory: 128Mi
    requests:
      cpu: 200m
      memory: 128Mi
  # JWT configuration
  # JWT signing type: "standard" or "kms"
  jwtSigningType: "kms"
  # KMS Key ID/ARN for JWT signing (required when jwtValidationType is "kms")
  kmsKeyId: ""
  jwtIssuer: "jupyter-k8s-auth"
  jwtAudience: "workspace-users"
  jwtExpiration: "1h"
  jwtRefreshWindow: "15m"
  jwtRefreshHorizon: "12h"
  # Cookie configuration
  cookieName: "workspace_auth"
  cookieSecure: "true"
  cookiePath: "/"
  cookieMaxAge: "24h"
  cookieHttpOnly: "true"
  cookieSameSite: "lax"
  # Path configuration
  pathRegexPattern: "^(/workspaces/[^/]+/[^/]+)(?:/.*)?$"
  maxCookiePaths: "20"
  # CSRF configuration
  # Required: must be provided as base64 encoded string (generate with: openssl rand -base64 32)
  csrfAuthKey: ""
  csrfCookieName: "workspace_csrf"
  csrfCookieMaxAge: "1h"
  csrfCookieSecure: "true"
  # Server configuration
  readTimeout: "10s"
  writeTimeout: "10s"
  shutdownTimeout: "30s"
  # Bearer auth configuration
  enableBearerAuth: true